import { connect } from "react-redux"
import { locate_user, on_viewport_change } from "../actions/UserMapActions.js"
import { firestore } from "../firebase"
import { loadQuestsSuccess } from "../actions"
import Map from '../components/Map'

const mapStateToProps = state => ({
  state: state
  map: state.map,
  quests: state.quests.quests
})

export default connect(mapStateToProps, {
  locate_user,
  on_viewport_change,
  actionFirestore: dispatch => {
    firestore.collection("quests").where("partner", "==", "").get()
      .then( querySnapshot => {
        var snapshot = []
        querySnapshot.forEach(docs =>{
          snapshot.push({
            key: docs.id,
            ...docs.data()
          })
          return dispatch(loadQuestsSuccess(snapshot))
        })
      })
      .catch(error => console.log(error.message))
  }
})(Map)
